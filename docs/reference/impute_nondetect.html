<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Impute Non-Detect Values in Laboratory Data — impute_nondetect • survlab</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Impute Non-Detect Values in Laboratory Data — impute_nondetect"><meta name="description" content="This function imputes non-detect (censored) values in environmental laboratory
analytical data using survival models with automatic distribution selection.
It validates data quality requirements and fits multiple distributions to
select the best model based on AIC. Each imputed value is guaranteed to be
below its respective detection limit and above the specified minimum value."><meta property="og:description" content="This function imputes non-detect (censored) values in environmental laboratory
analytical data using survival models with automatic distribution selection.
It validates data quality requirements and fits multiple distributions to
select the best model based on AIC. Each imputed value is guaranteed to be
below its respective detection limit and above the specified minimum value."><meta property="og:image" content="https://lpereira-ue.github.io/survlab/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">survlab</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lpereira-ue/survlab"><span class="fa fab fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Impute Non-Detect Values in Laboratory Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/lpereira-ue/survlab/blob/HEAD/R/impute_nondetect.R" class="external-link"><code>R/impute_nondetect.R</code></a></small>
      <div class="d-none name"><code>impute_nondetect.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function imputes non-detect (censored) values in environmental laboratory
analytical data using survival models with automatic distribution selection.
It validates data quality requirements and fits multiple distributions to
select the best model based on AIC. Each imputed value is guaranteed to be
below its respective detection limit and above the specified minimum value.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">impute_nondetect</span><span class="op">(</span></span>
<span>  <span class="va">dt</span>,</span>
<span>  value_col <span class="op">=</span> <span class="st">"value"</span>,</span>
<span>  cens_col <span class="op">=</span> <span class="st">"censored"</span>,</span>
<span>  parameter_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  unit_col <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gaussian"</span>, <span class="st">"lognormal"</span>, <span class="st">"weibull"</span>, <span class="st">"exponential"</span>, <span class="st">"logistic"</span>, <span class="st">"loglogistic"</span><span class="op">)</span>,</span>
<span>  min_observations <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  max_censored_pct <span class="op">=</span> <span class="fl">75</span>,</span>
<span>  min_value <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dt">dt<a class="anchor" aria-label="anchor" href="#arg-dt"></a></dt>
<dd><p>A data.frame or data.table containing laboratory analytical data</p></dd>


<dt id="arg-value-col">value_col<a class="anchor" aria-label="anchor" href="#arg-value-col"></a></dt>
<dd><p>Character string specifying the column name containing values</p></dd>


<dt id="arg-cens-col">cens_col<a class="anchor" aria-label="anchor" href="#arg-cens-col"></a></dt>
<dd><p>Character string specifying the column name containing censoring indicators (0 = non-detect/censored, 1 = detected/observed)</p></dd>


<dt id="arg-parameter-col">parameter_col<a class="anchor" aria-label="anchor" href="#arg-parameter-col"></a></dt>
<dd><p>Character string specifying the column name containing parameter names (optional, for validation)</p></dd>


<dt id="arg-unit-col">unit_col<a class="anchor" aria-label="anchor" href="#arg-unit-col"></a></dt>
<dd><p>Character string specifying the column name containing units (optional, for validation)</p></dd>


<dt id="arg-dist">dist<a class="anchor" aria-label="anchor" href="#arg-dist"></a></dt>
<dd><p>Character vector of distributions to test. Options include: "gaussian", "lognormal", "weibull", "exponential", "logistic", "loglogistic"</p></dd>


<dt id="arg-min-observations">min_observations<a class="anchor" aria-label="anchor" href="#arg-min-observations"></a></dt>
<dd><p>Minimum number of observations required for modeling (default: 25)</p></dd>


<dt id="arg-max-censored-pct">max_censored_pct<a class="anchor" aria-label="anchor" href="#arg-max-censored-pct"></a></dt>
<dd><p>Maximum percentage of censored values allowed (default: 75)</p></dd>


<dt id="arg-min-value">min_value<a class="anchor" aria-label="anchor" href="#arg-min-value"></a></dt>
<dd><p>Minimum allowable value for imputed concentrations (default: 0, use 1e-10 for strictly positive)</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical indicating whether to display progress messages and distribution fitting information (default: FALSE)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data.table with additional columns:</p><dl><dt>[value_col]_imputed</dt>
<dd><p>Imputed values for non-detect observations</p></dd>

  <dt>[value_col]_final</dt>
<dd><p>Final values combining original detected and imputed non-detect values</p></dd>


</dl><p>The returned object also has attributes containing model information:</p><dl><dt>best_model</dt>
<dd><p>The fitted survival model object</p></dd>

  <dt>best_distribution</dt>
<dd><p>Name of the best-fitting distribution</p></dd>

  <dt>detection_limits</dt>
<dd><p>Vector of all detection limits found in the data</p></dd>

  <dt>max_detection_limit</dt>
<dd><p>The highest detection limit (for reference)</p></dd>

  <dt>parameter</dt>
<dd><p>Parameter name (if parameter_col provided)</p></dd>

  <dt>unit</dt>
<dd><p>Unit of measurement (if unit_col provided)</p></dd>

  <dt>aic</dt>
<dd><p>AIC value of the best model</p></dd>

  <dt>sample_size</dt>
<dd><p>Total number of observations</p></dd>

  <dt>censored_pct</dt>
<dd><p>Percentage of censored observations</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs several validation checks:
1. Ensures sufficient sample size (&gt;= min_observations)
2. Checks that censoring percentage is reasonable (&lt;= max_censored_pct)
3. Validates that only one parameter and unit are present (if columns provided)
4. Tests multiple distributions and selects the best based on AIC
5. Generates random imputed values below each observation's detection limit and above min_value</p>
<p>For non-detect observations (censored = 0), the value in value_col is treated
as the detection limit for that specific analysis, allowing for different
detection limits across samples or analytical methods.</p>
<p>IMPORTANT: This function should be applied to data containing only ONE parameter
at a time. Different environmental parameters have different distributions and
should not be modeled together.</p>
<p>When verbose = FALSE, the function operates silently except for critical errors,
making it suitable for batch processing of multiple parameters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">multi_censored_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Basic imputation with default settings</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">impute_nondetect</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="va">multi_censored_data</span>,</span></span>
<span class="r-in"><span>  value_col <span class="op">=</span> <span class="st">"value"</span>,</span></span>
<span class="r-in"><span>  cens_col <span class="op">=</span> <span class="st">"censored"</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View imputed values for non-detects</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">result</span><span class="op">[</span><span class="va">censored</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fu">.</span><span class="op">(</span><span class="va">value</span>, <span class="va">value_imputed</span>, <span class="va">value_final</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    value value_imputed value_final</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;num&gt;         &lt;num&gt;       &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:    25      8.487192    8.487192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:    15     10.300671   10.300671</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:     5      4.937120    4.937120</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:     5      4.798058    4.798058</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:     5      4.408386    4.408386</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:     5      4.284067    4.284067</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Check best distribution selected</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">result</span>, <span class="st">"best_distribution"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "lognormal"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With parameter and unit validation</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">impute_nondetect</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="va">multi_censored_data</span>,</span></span>
<span class="r-in"><span>  value_col <span class="op">=</span> <span class="st">"value"</span>,</span></span>
<span class="r-in"><span>  cens_col <span class="op">=</span> <span class="st">"censored"</span>,</span></span>
<span class="r-in"><span>  parameter_col <span class="op">=</span> <span class="st">"parameter"</span>,</span></span>
<span class="r-in"><span>  unit_col <span class="op">=</span> <span class="st">"unit"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># For strictly positive values (avoiding exactly zero)</span></span></span>
<span class="r-in"><span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">impute_nondetect</span><span class="op">(</span></span></span>
<span class="r-in"><span>  dt <span class="op">=</span> <span class="va">multi_censored_data</span>,</span></span>
<span class="r-in"><span>  value_col <span class="op">=</span> <span class="st">"value"</span>,</span></span>
<span class="r-in"><span>  cens_col <span class="op">=</span> <span class="st">"censored"</span>,</span></span>
<span class="r-in"><span>  min_value <span class="op">=</span> <span class="fl">1e-10</span>,</span></span>
<span class="r-in"><span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luís Pereira, Paulo Infante.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

